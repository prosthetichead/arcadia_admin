<!-- extend from base layout -->
{% extends "base.html" %}

{% block scripts %}
<script>

function get_json(url) {
     $.getJSON("{{ platform.id }}/_rom_scan",function(data){
        return data;
    });    
}

    function changeSort(sort, order) {
        sort = encodeURIComponent(sort);
        order = encodeURIComponent(order);
        var baseURL = window.location.href.split("?")[0];
        window.location.replace(baseURL + '?sort=' + sort + '&order=' + order);
    }

function rom_scan(){
    var data = get_json("{{ platform.id }}/_rom_scan");
    console.log(data);
    while (data.status != 'ended'){
        console.log(data.total_files);
        console.log(data.files_processed);
        $("#progressBar").css("width", data.files_processed);
        data = get_json("{{ platform.id }}/_rom_scan");
    }
}
</script>
{% endblock %}

{% block nav_left %}
<ul class="nav navbar-nav">
    <li> <a onclick="rom_scan()" href="javascript:void(0);">Rescan Roms</a></li>
    <li><a href="#">Add Rom File</a></li>
    <li><a href="{{platform.id}}/edit">Edit Platform</a> </li>
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Import From<span class="caret"></span></a>
        <ul class="dropdown-menu" role="menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
</ul>
{% endblock %}


{% block breadcrumb %}
     <ol class="breadcrumb ">
       <li><a href="/">Home</a></li>
       <li><a href="/platform">Platform</a></li>
       <li class="active">{{platform.name}}</li>
     </ol>
{% endblock %}

{% block content %}
<div class="progress progress-striped active" style="height:44px;">
    <div id="progressBar" class="bar" style="height:44px;width:1%;background-color:green"></div>
</div>

        <div class="row">
            <div class="col-xs-6">
                <div class="panel panel-default">
                <div class="panel-heading"><a data-toggle="collapse" data-parent="#accordion" href="#platform_panel">{{platform.name}} Platform Details</a></div>
                    <div id="platform_panel" class="panel-collapse collapse out">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-xs-6 col-md-4"><p><strong>Platform ID</strong> {{platform.id}}</p></div>
                            <div class="col-xs-6 col-md-8"><p><strong>Description</strong></p><div style="text-align: justify; text-justify: inter-word;">{{platform.desc | nl2br}}</div> </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-md-4"><p><strong>Alias</strong> {{platform.alias}}</p></div>

                        </div>
                    </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-6">.col-xs-6</div>
        </div>


    <table class="table table-striped table-hover">
        <tr><th>NAME
            <a onclick="changeSort('name','asc')" href="javascript:void(0);"><span class="glyphicon glyphicon-sort-by-alphabet"></span></a>
            <a onclick="changeSort('name','desc')" href="javascript:void(0);"><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a>
        </th>
            <th>FILE NAME
                <a onclick="changeSort('file_name','asc')" href="javascript:void(0);"><span class="glyphicon glyphicon-sort-by-alphabet"></span></a>
                <a onclick="changeSort('file_name','desc')" href="javascript:void(0);"><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a>
            </th>
            <th>GENRE
                <a onclick="changeSort('genre_id','asc')" href="javascript:void(0);"><span class="glyphicon glyphicon-sort-by-alphabet"></span></a>
                <a onclick="changeSort('genre_id','desc')" href="javascript:void(0);"><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a>
            </th>
            <th>ACTIVE
                <a onclick="changeSort('active','asc')" href="javascript:void(0);"><span class="glyphicon glyphicon-sort-by-alphabet"></span></a>
                <a onclick="changeSort('active','desc')" href="javascript:void(0);"><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a>
            </th>

        </tr>
        {% for game in games %}
            <tr class="{% if game.active %} success {% else %} danger {% endif %} ">
                <td>{{game.name}}</td>
                <td>{{game.file_name}}</td>
                <td>{{game.genre.genre_name}}</td>
                <td class="text-center">{% if game.active %} <span class="glyphicon glyphicon-ok"></span> {% else %}   {% endif %}</td>
                </tr>
        {% endfor %}
    </table>

{% endblock %}